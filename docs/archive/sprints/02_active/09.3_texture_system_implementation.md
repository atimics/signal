
# Sprint 9.3: Texture System Implementation

**Duration**: 2 Days
**Priority**: High
**Dependencies**: Sprint 9.2

## Sprint Goal
Complete the texture mapping system by implementing GPU texture loading, updating the shaders to sample textures, and modifying the rendering pipeline to bind and use them. This will replace the solid material colors with actual textures on the meshes.

## Current State
- ✅ The rendering pipeline is stable and correctly rendering meshes with solid colors.
- ✅ The asset system loads texture file paths from the asset metadata.
- ❌ Textures are not yet loaded to the GPU as `sg_image` resources.
- ❌ The rendering pipeline does not bind textures for drawing.
- ❌ The shaders do not yet sample from textures to determine the final fragment color.

## Technical Tasks

### Task 9.3.1: GPU Texture Loading
**Estimated**: 1 day
**Files**: `src/assets.c`, `src/assets.h`

#### Acceptance Criteria
- [ ] Create a new function, `assets_load_texture_to_gpu(Texture* texture)`, that uses `stb_image` to load a texture from file and `sg_make_image` to create a Sokol GPU resource.
- [ ] The `sg_image` handle must be stored in the `Texture` struct.
- [ ] Modify the main asset loading process to call this function for all discovered textures.
- [ ] Add robust error handling for missing or corrupt texture files.

### Task 9.3.2: Update Shaders for Texturing
**Estimated**: 0.5 days
**Files**: `assets/shaders/basic_3d.frag.metal`, `assets/shaders/basic_3d.frag.glsl`

#### Acceptance Criteria
- [ ] The fragment shader must be updated to accept a `sampler2D` uniform for the diffuse texture.
- [ ] The shader must use the incoming `texcoord` attribute to sample the texture.
- [ ] The final fragment color must be determined by the sampled texture color, modulated by the material's diffuse color and basic lighting.

### Task 9.3.3: Update Render Pipeline for Texture Binding
**Estimated**: 0.5 days
**Files**: `src/render_3d.c`

#### Acceptance Criteria
- [ ] The `render_frame` (or `render_mesh`) function must be updated to get the correct texture for the entity being rendered.
- [ ] The `sg_bindings` struct must be updated to bind the entity's `sg_image` to the fragment shader's texture slot.
- [ ] If an entity has no texture, a default 1x1 white texture should be bound to prevent rendering errors.

## Definition of Done
- [ ] All meshes now render with their correct diffuse textures instead of solid colors.
- [ ] The texture system gracefully handles missing textures by applying a default texture.
- [ ] The application compiles and runs without any visual or functional regressions.
- [ ] The foundation is laid for a multi-texture PBR system in future sprints.
